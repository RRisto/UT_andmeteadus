{
    "contents" : "---\ntitle: \"Kodutöö 1\"\nauthor: \"Risto Hinno\"\ndate: \"Friday, May 01, 2015\"\noutput: html_document\n---\n\n\n##Suurimad tõusjad\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\nandmed_alg=read.csv(\"aktsiad.csv\", sep=\";\")\n#teen originaalist koopia, mida siin kasutan\nandmed=andmed_alg\nlibrary(dplyr)\n#kolme parima tootlusega firma symbol, nimi ja tootlus\nparim_tootlus=andmed %>%\n    select(symbol,nimi, tootlus)%>%\n    arrange(desc(tootlus))%>%\n    head(3)\nlibrary(knitr)\nkable(parim_tootlus)\n```\n\nVõttes aluseks 01.05.2015 yahoo andmed:\n\n```{r, echo=FALSE, message=FALSE,warning=FALSE, error=FALSE,cache=TRUE, include=FALSE}\n\n#funktsioon, et andmedyahoost tõmmata ja kokku mergida\nandmed_yahoost = function(algfail){\n    #library(dplyr)\n    library(\"quantmod\")\n    #võtame symbolid, mille kohta infot tõmmata\n    symbols=unique(algfail$symbol)\n    symbols=as.character(symbols)\n    #tõmbame andmed yahoost\n    data=getQuote(symbols,src = \"yahoo\",\n                  what=yahooQF(c(\"Last Trade (Price Only)\",\n                                 \"Symbol\",\"Change in Percent\",\n                                 \"Volume\", \n                                 \"Earnings/Share\", \n                                 \"Dividend/Share\")))\n    #võtame algfailist ainult vajalikud andmed\n    andmed_select=select(algfail, symbol, nimi, sektor, aktsiate_arv)\n    #väiketähtdeks columnite nimed (vaja et kokku mergida)\n    names(data)=tolower(names(data))\n    #mergime kokku\n    andmed_merge=merge(andmed_select, data, by=\"symbol\")\n    #teeme nimed korda\n    names(andmed_merge)=c(\"symbol\", \"nimi\", \"sektor\",\"aktsiate_arv\", \"trade time\", \"hind\", \"tootlus\", \"kogus\", \"kasum_aktsia_kohta\",\"dividend_aktsia_kohta\")\n    #võtame tootlusest sodi välja\n    andmed_merge$tootlus=gsub(\"\\\\+\",\"\", andmed_merge$tootlus)\n    andmed_merge$tootlus=gsub(\"\\\\-\",\"\", andmed_merge$tootlus)\n    andmed_merge$tootlus=gsub(\"\\\\%\",\"\", andmed_merge$tootlus)\n    #teeme numericuks\n    andmed_merge$tootlus=as.numeric(as.character(andmed_merge$tootlus))\n\n    andmed_merge\n}\n\nandmed_yahoo=andmed_yahoost(andmed)\nparim_tootlus_y=andmed_yahoo %>%\n    select(symbol,nimi, tootlus)%>%\n    arrange(desc(tootlus))%>%\n    head(3)\nlibrary(knitr)\ntulem=kable(parim_tootlus_y)\n```\n`r tulem`\n\n##Suurimad kukkujad\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\n#kolme halvima tootlusega firma symbol, nimi ja tootlus\nhalvim_tootlus=andmed %>%\n    select(symbol,nimi, tootlus)%>%\n    arrange(tootlus)%>%\n    head(3)\nlibrary(knitr)\nkable(halvim_tootlus)\n```\n\nVõttes aluseks yahoo andmed:\n\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\n#kolme halvima tootlusega firma symbol, nimi ja tootlus\nhalvim_tootlus_y=andmed_yahoo %>%\n    select(symbol,nimi, tootlus)%>%\n    arrange(tootlus)%>%\n    head(3)\nlibrary(knitr)\nkable(halvim_tootlus_y)\n```\n\n\n##Ülevaade sektorite lõikes\n```{r, echo=FALSE}\n#teeme hinna factorist numericuks\nandmed$hind=as.numeric(as.character(andmed$hind))\n#arvutame juurde käibe\nandmed=mutate(andmed, kaive=hind*kogus)\n#grupeerime sektori järgi\nsektori_grupp=group_by(andmed, sektor)\n#arvutame kesk. tootluse, kogukäibe, kesk. käibe ja ettev. arvu\nsektori_loikes <- summarise(sektori_grupp,\n                            keskmine_tootlus=mean(tootlus, na.rm=T),\n                            kogukaive=sum(kaive, na.rm=T),\n                            keskmine_kaive=mean(kaive, na.rm=T),\n                            ettevotete_arv=n())\nsektori_loikes=filter(sektori_loikes, ettevotete_arv>=30)\nkable(sektori_loikes)\n```\n\nVõttes aluseks yahoo andmed:\n```{r, echo=FALSE, include=FALSE}\n#teeme hinna factorist numericuks\nandmed_yahoo$hind=as.numeric(as.character(andmed_yahoo$hind))\n#teeme koguse ka numericuks\nandmed_yahoo$kogus=as.numeric(as.character(andmed_yahoo$kogus))\n#arvutame juurde käibe\nandmed_yahoo=mutate(andmed_yahoo, kaive=hind*kogus)\n#grupeerime sektori järgi\nsektori_grupp_yahoo=group_by(andmed_yahoo, sektor)\n#arvutame kesk. tootluse, kogukäibe, kesk. käibe ja ettev. arvu\nsektori_loikes_yahoo <- summarise(sektori_grupp_yahoo,\n                            keskmine_tootlus=mean(tootlus, na.rm=T),\n                            kogukaive=sum(kaive, na.rm=T),\n                            keskmine_kaive=mean(kaive, na.rm=T),\n                            ettevotete_arv=n())\nsektori_loikes_yahoo=filter(sektori_loikes_yahoo, ettevotete_arv>=30)\ntulem2=kable(sektori_loikes_yahoo)\n```\n`r tulem2`\n\n##Kauplemisalgoritm\n\nKirjuta funktsioon kauplemisalgoritm, mille sisendiks on andmestik data ja mis tagastab kolme kõige atraktiivsema ettevõtte sümbolid, mis saavadki ostusoovitusteks.\n\nJuhised:\n\nKõigepealt tekita andmestikku juurde järgmised kaks tunnust:\n\n- kasumi-aktsiahinna suhe (kasum_aktsia_kohta/hind) [kui sa tead, mida tähendab PE suhe, siis me arvutame PE suhte pöördväärtust]\n\n- dividendi määr (dividend_aktsia_kohta/hind)\n\nArvuta iga aktsia kohta atraktiivsuse skoor, mis on arvutatud järgnevalt 0.5 * kasumi-aktsiahinna suhe + 0.5 * dividendi määr\n\nOstusoovituseks leia kolm kõige suurema skooriga aktsiat.\n\nKui eelnevaga oled hakkama saanud, siis proovi eelnev kood kirjutada funktsiooniks, mis võtab sisendiks suvalise andmestiku ning väljastab kolme kõige atraktiivsema ettevõtte aktsiate sümbolid vektorina. (Näpunäide: Kui meil on andmetabel df, siis sealt saab veeru tunnus vektorina välja võtta dollarimärgiga df$tunnus.)\n\n```{r, echo=FALSE}\n#teeme ka need factoriks\nandmed$kasum_aktsia_kohta=as.numeric(as.character(andmed$kasum_aktsia_kohta))\nandmed$dividend_aktsia_kohta=as.numeric(as.character(andmed$dividend_aktsia_kohta))\n\n#arvutame juurde vajalikud muutujad\nandmed=mutate(andmed, \n              kasum_aktsiahinna_suhe=kasum_aktsia_kohta/hind,\n              dividendi_maar=dividend_aktsia_kohta/hind)\nandmed=mutate(andmed, atraktiivsus_skoor=0.5*kasum_aktsiahinna_suhe+0.5*dividendi_maar)\nandmed=arrange(andmed, desc(atraktiivsus_skoor))\n#andmed$symbol [1:3]\n```\n\n```{r, echo=FALSE}\n#funktsioon\nkauplemisalgoritm = function(x){\n    x$kasum_aktsia_kohta=as.numeric(as.character(x$kasum_aktsia_kohta))\n    x$dividend_aktsia_kohta=as.numeric(as.character(x$dividend_aktsia_kohta))\n    \n    #arvutame juurde vajalikud muutujad\n    x=mutate(x, \n                  kasum_aktsiahinna_suhe=kasum_aktsia_kohta/hind,\n                  dividendi_maar=dividend_aktsia_kohta/hind)\n    x=mutate(x, atraktiivsus_skoor=0.5*kasum_aktsiahinna_suhe+0.5*dividendi_maar)\n    x=arrange(x, desc(atraktiivsus_skoor))\n    x$symbol [1:3]\n}\n\n#kauplemisalgoritm(andmed)\n```\n\n##Turvaline kauplemisalgoritm\n\nNüüd kirjuta funktsioon kauplemisalgoritm_turvaline, kus valid atraktiivseid aktsiaid vaid populaarsete aktsiate hulgast. Populaarsed aktsiad on järgnevad: AAPL, FB, GOOG, IBM, TSLA.\n\nJuhised:\n\n- Vali andmestikust välja ainult aktsiad AAPL, FB, GOOG, IBM, TSLA. Rakenda saadud alamandmestikul eelnevas ülesandes kirjutatud funktsiooni.\n\n- Kui eelnev töötab, siis kirjuta eelnev kood funktsiooniks.\n\n```{r, echo=FALSE}\nandmed2=andmed_alg\nandmed2=filter(andmed2, symbol %in% c(\"AAPL\", \"FB\", \"GOOG\", \"IBM\", \"TSLA\"))\n#kauplemisalgoritm(andmed2)\n\n#teen funktsiooniks\nkauplemisalgoritm_turvaline = function(x){\n  x=filter(x, symbol %in% c(\"AAPL\", \"FB\", \"GOOG\", \"IBM\", \"TSLA\"))\n  kauplemisalgoritm(x)\n}\n#testime, kas saame sama tulemuse\nvastus=kauplemisalgoritm_turvaline(andmed)\n```\n\nSeega tasub osta neid aktsiaid: `r vastus`.",
    "created" : 1430478892708.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3028686624",
    "id" : "1A6AD493",
    "lastKnownWriteTime" : 1430498608,
    "path" : "~/Minu asjad/Statistika, mudelid, excel/R/Andmeteadus_TU/I praktikum/kodutoo.Rmd",
    "project_path" : "kodutoo.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}