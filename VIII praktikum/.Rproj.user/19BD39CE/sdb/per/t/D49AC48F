{
    "contents" : "---\ntitle: \"Doping\"\nauthor: \"Risto Hinno\"\ndate: \"Saturday, June 27, 2015\"\noutput: pdf_document\n---\n\n##Sissejuhatus\n\nSander “Gamma” Lognormaalsele meeldib võistelda. Eelmine nädal käis ta rahvusvahelisel statistikaolümpiaadil, kus ta ei suutnud enamat pronksmedalist. Olümpiaadil tuli lahendada mitmeid huvitavaid statistikaülesandeid. Teoreetilises osas oli vaja tuvastada, kas mõni hinnang on nihkega või nihketa. Praktiline osa algas aja peale andmete sisestamisega SASi. Seekord oli praktiline osa eriti põnev, kuna töötati reaalsete andmetega: andmetabelis oli 11 vaatlust ning 2 tunnust. Sellele järgnes osa “Märka olulisi tunnuseid”, kus tuli aja peale SASi väljundist üles leida tunnused, mille p-väärtus on väiksem kui 0.05.\n\nOma tulemusi analüüsides sai Sandrile selgeks, et konkurentidele jäi ta alla viimases, väikeste p-väärtuste märkamise voorus. Ta kahtlustas, et konkurentide paremus tulenes tähelepanu tõstvate ainete manustamisest ning statistikaolümpiaadil tuleks kehtestada dopingutestid. Aga kuidas seda teha? Õnneks leidis ta, et Krista Fischer on tegelenud ühe dopingujuhtumi analüüsimisega, ning on koos Donald A. Berryga kirjutanud artikli [Statisticians Introduce Science to International Doping Agency: The Andrus Veerpalu Case](http://chance.amstat.org/2014/09/doping/).\n\nSelles praktikumis uurimegi sellesama dopingujuhtumi näitel, kuidas kasvuhormooni dopingutesti piirmäärad seati ning mille vastu eksiti.\n\n##Kasvuhormoonist\n\nKasvurhormoon on inimkehas toodetud aine, mille ülesanne on reguleerida kehapikkust, lihaste ja organite kasvu. Ravimina on kasutusel sünteetiline kasvuhormoon, mida kasutatakse näiteks laste kasvudefektide ravis ja aidsihaigete üldseisundi parandamiseks. Kuigi teaduslikult pole tõestatud, et sünteetilise kasvuhormooni pruukimine tõstab sportlikke tulemusi (vt [Stanfordi ülikooli teadlaste meta-analüüs](http://annals.org/article.aspx?articleid=741027), mis võtab kokku 27 uuringu tulemused), on spordiringkond siiski arvamusel selle positiivsest mõjust ning 1989. aastal lisas Rahvusvaheline Olümpiakomitee kasvuhormooni keelatud ainete nimistusse.\n\nSünteetilise kasvuhormooni kasutamist on raske tuvastada. Üks põhjustest on kasvuhormooni kontsentratsiooni suur varieeruvus päeva lõikes ning pulsseeruv sekretsioon.\n\n[Saksa teadlaste 2009. aastal väljatöötatud test](http://www.clinchem.org/content/55/3/445.long) ei kontrolligi kasvuhormooni taset, vaid hormooni erinevate molekulitüüpide omavahelist tasakaalu. Eeldatakse, et erinevate isovormide suhe on ajas konstantne. Kuna arvatakse, et sünteetiline kasvuhormooni süstimisel muutub vaid ühe isovormi tase veres. Dopingutesti idee seisnebki testimises, kas kahe isovormi suhe on statistiliselt erinev loomulikust suhtest.\n\n\n##Andmestik\n\nLaadi ÕISist alla andmestik doping.csv ja loe töökeskkonda. Andmestikus on järgmised tunnused:\n\n- ethnicity - etnilisus: kas african või caucasian\n\n- kit - dopingutesti erinevad variandid (kit1 ja kit2)\n\n- rec - kasvuhormooni isovormi rec kontsentratsioon\n\n- pit - kasvuhormooni isovormi pit kontsentratsioon\n\n##Ülesanne 1 (1 punkt) - andmetega tutvumine\n\nLisa andmetabelisse tunnus ratio, mis näitab tunnuste rec ja pit suhet. Visualiseeri tunnuste rec, pit ja ratio jaotusi.\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\ndoping=read.csv(\"./data/doping.csv\")\n#lisame ratio\ndoping$ratio=doping$rec/doping$pit\n#rec jaouts\nlibrary(ggplot2)\nggplot(doping, aes(x=rec))+\n    geom_density()\n#pit\nggplot(doping, aes(x=pit))+\n    geom_density()\n#ratio\nggplot(doping, aes(x=ratio))+\n    geom_density()\n\n```\n\n##Ülesanne 2 (3 punkti) - jaotustest\n\nKodutööna lugesid artiklit Statisticians Introduce Science to International Doping Agency: The Andrus Veerpalu Case. Said teada, et dopingutest põhines kasvuhormooni isovormide suhtel ehk tunnusel ratio. Mingi hetk kasutati isovormide suhte modelleerimiseks log-normaalset jaotust, mingil hetkel see enam ei sobinud ning kasutusele võeti gammajaotus.\n\nAga millised näevad välja log-normaaljaotus ning gammajaotus? Selleks visualiseeri neid. \n```{r, cache=TRUE, message=FALSE, warning=FALSE}\n#log-normaalse jaoutse tihedus\nlibrary(ggplot2)\nlibrary(dplyr)\n\ni = 1\ndf_list = list()\nfor(m in c(0, 0.5, 1, 1.5)){\n    for(s in c(0.25, 0.5, 1, 2)){\n        # tiheduse graafiku jaoks x ja y koordinaadid\n        x = seq(0, 5, 0.01)\n        y = dlnorm(x, meanlog = m, sdlog = s)\n        \n        df_list[[i]] = data.frame(x=x, y=y, \n                                  group = paste(\"meanlog =\", m, \", sdlog =\", s))\n        i = i + 1\n    }\n}\ndf = rbind_all(df_list)\nggplot(df, aes(x, y)) + geom_area() + facet_wrap(~ group) + \n    coord_cartesian(ylim = c(0, 1))\n\n\n```\n\n\nJoonista ka gammajaotuse tihedusfunktsioonid erinevate alfa on{1,2,3,4,5} ja beeta on {1,2,3,4,5} jaoks. Selgita, kuidas muutub jaotus, kui muudame kumbagi parameetrit.\n\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\ni = 1\ndf_list_gamma = list()\nfor(m in c(1, 2, 2, 4, 5)){\n    for(s in c(1, 2, 2, 4, 5)){\n        # tiheduse graafiku jaoks x ja y koordinaadid\n        x = seq(0, 5, 0.01)\n        y = dgamma(x, shape = m, rate = s)\n        \n        df_list_gamma[[i]] = data.frame(x=x, y=y, \n                                  group = paste(\"shape =\", m, \", rate =\", s))\n        i = i + 1\n    }\n}\ndf_gamma = rbind_all(df_list_gamma)\nggplot(df_gamma, aes(x, y)) + geom_area() + facet_wrap(~ group) + \n    coord_cartesian(ylim = c(0, 1))\n\n```\n\nTihti eeldatakse statistikas, et tunnus on normaaljaotusega. Kas isovormide suhe võiks põhimõtteliselt olla normaaljaotusega? Põhjenda.\n\nEi. Üritan sobitada peale normaaljaotust joonisel.\n\n```{r, cache=TRUE, warning=FALSE}\nggplot(doping, aes(x=ratio))+\n    geom_density(colour=\"blue\")+\n    stat_function(fun=dnorm)\n\n```\n\n\n##WADA metoodika analüüs\n\nLühikokkuvõte, kuidas määras otsustuspiirid WADA.\n\n- Analüüsist jäeti välja andmepunktid, kus rec või pit kontsentratsioon oli väiksem kui 0.05.\n\n- Neljale osagrupile (kit1 - valged, kit1 - mustanahalised, kit2 - valged, kit2 - mustanahalised) sobitati parameetriline jaotus.\n\n- WADA väitel sobitus lognormaalne jaotus andmetele kõige paremini.\n\n- Otsustuspiiriks võeti 99.99% log-normaaljaotuse kvantiil.\n\n- Võeti kasutusele mustanahaliste piirmäärad, sest need olid suuremad.\n\n##Ülesanne 3 (2 punkti) - andmete filtreerimine\n\n- Mis sa arvad, miks jäeti analüüsist välja andmepunktid, kus rec või pit kontsentratsioon oli väiksem kui 0.05?\nEi tea täpselt.Kuna nende ratio oli kõikuv?\n\n- Visualiseeri hajuvusdiagrammi abil, millised andmepunktid jäid analüüsist välja.\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\nvaljajaanud=subset(doping, rec<0.05| pit<0.05)\n\nggplot(valjajaanud, aes(x=rec))+\n    geom_density()\n\nggplot(valjajaanud, aes(x=pit))+\n    geom_density()\n\nggplot(valjajaanud, aes(x=ratio))+\n    geom_density()\n\n```\n\nEdasises kasuta andmestikku, kus rec ja pit on suuremad kui 0.05.\n\n```{r, cache=TRUE, message=FALSE}\ndoping_subset=subset(doping, rec>0.05& pit>0.05)\n\n```\n\n\n##Ülesanne 4 (4 punkti) - parameetrilise jaotuse sobitamine\n\n[Log-normaaljaotusel](http://en.wikipedia.org/wiki/Log-normal_distribution) on kaks parameetrit. Kuidas leiad sellised parameetrite väärtused, mille korral jaotus sobiks andmetega kõige paremini? Leia need parameetrid “kit1 - valged” osapopulatsiooni jaoks.\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\nlibrary(MASS)\nlog_norm_param=fitdistr(x=doping_subset[c(doping_subset$kit==1&doping_subset$ethnicity==\"caucasian\"), c(\"ratio\")], \n         densfun=\"log-normal\")\n\nmeanlog1=log_norm_param$estimate[1]\nsdlog1=log_norm_param$estimate[2]\n\n```\n\n\nKa [gammajaotusel](http://en.wikipedia.org/wiki/Gamma_distribution) on kaks parameetrit. Kuidas leiad sellised parameetrite väärtused, mille korral jaotus sobiks andmetega kõige paremini? Leia need parameetrid “kit1 - valged” osapopulatsiooni jaoks.\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\ngamma_param=fitdistr(x=doping_subset[c(doping_subset$kit==1&doping_subset$ethnicity==\"caucasian\"), c(\"ratio\")], \n                        densfun=\"gamma\")\n\nshape1=gamma_param$estimate[1]\nrate1=gamma_param$estimate[2]\n\n```\n\nLeia kummagi jaotuse 99.99% kvantiil.\n```{r, cache=TRUE, message=FALSE,warning=FALSE}\n#log-normal\nqlnorm(0.9999, meanlog = meanlog1, sdlog = sdlog1)\n#gamma\nqgamma(0.9999, shape=shape1, rate = rate1)\n\n```\n\n\nVisualiseeri ühel joonisel koos andmetega nii sobitatud log-normaal kui ka gammajaotust. Lisa joonisele 99.99% kvantiil.\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\nkit1_caucasian=doping_subset[c(doping_subset$kit==1&doping_subset$ethnicity==\"caucasian\"),]\n\nggplot(kit1_caucasian, aes(x=ratio))+\n    geom_histogram(aes(y=..density..), binwidth=0.06, fill=\"white\", colour=\"black\" )+\n    stat_function(fun=dlnorm, args = list(meanlog=meanlog1, sdlog=sdlog1))+\n    stat_function(fun=dgamma, args=list(shape=shape1, rate=rate1), colour=\"blue\")+\n    geom_vline(xintercept=qlnorm(p=0.9999, meanlog = meanlog1, sdlog = sdlog1))+\n    geom_vline(xintercept=qgamma(p=0.9999, shape = shape1, rate = rate1), colour=\"blue\")+\n    coord_cartesian(xlim=c(0, 1.8))\n\n```\n\n##Ülesanne 5 (3 punkti) - kas jaotus sobib andmetega\n\n- Kas eelnevalt sobitatud log-normaaljaotus võiks sobida andmetega? Mille alusel otsustad?\n\n- Aga kas gammajaotus võiks sobida andmetega?\n\n- Praktikumis arutasime märksõnu QQplot ja Kolmogorov-Smirnovi test.\n\n- Oletame, et mõlemad jaotused sobisid andmetega. Mille põhjal langetad otsuse, kumb sobib paremini?\n\n- WADA väitis, et log-normaaljaotus sobib andmetele kõige paremini. Kas said sama tulemuse?\n\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\nqqnorm(kit1_caucasian$ratio)\nqqline(kit1_caucasian$ratio)\n#gamma sobivuse test\nks.test(kit1_caucasian$ratio,\"pgamma\", shape=shape1, rate=rate1)\n#log-normali sobivuse test\nks.test(kit1_caucasian$ratio,\"dlnorm\", meanlog=meanlog1, sdlog=sdlog1)\n\n```\n\nEi saanud. Sain, et gammajaotus sobib. Log-normaalsele jaotusele ei allu statistiliselt olulisel määral. Kui mõlemad sobiks, siis üks võimalus oleks vaadata p-väärtust.\n\n##Ülesanne 6 (2 punkti) - piirmäärad alamgruppide kaupa\n\nSobita nüüd kõigile neljale alamgrupile log-normaaljaotus ja leia selle 99.99% kvantiil.\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\nkit2_caucasian=doping_subset[c(doping_subset$kit==2&doping_subset$ethnicity==\"caucasian\"),]\nkit1_african=doping_subset[c(doping_subset$kit==1&doping_subset$ethnicity==\"african\"),]\nkit2_african=doping_subset[c(doping_subset$kit==2&doping_subset$ethnicity==\"african\"),]\n#valged kit2\nlog_norm_param2=fitdistr(x=kit2_caucasian$ratio, densfun=\"log-normal\")\nmeanlog2=log_norm_param2$estimate[1]\nsdlog2=log_norm_param2$estimate[2]\nqlnorm(0.9999, meanlog = meanlog2, sdlog = sdlog2)\n#mustad kit1\nlog_norm_param3=fitdistr(x=kit1_african$ratio, densfun=\"log-normal\")\nmeanlog3=log_norm_param3$estimate[1]\nsdlog3=log_norm_param3$estimate[2]\nqlnorm(0.9999, meanlog = meanlog3, sdlog = sdlog3)\n#mustad kit2\nlog_norm_param4=fitdistr(x=kit2_african$ratio, densfun=\"log-normal\")\nmeanlog4=log_norm_param4$estimate[1]\nsdlog4=log_norm_param4$estimate[2]\nqlnorm(0.9999, meanlog = meanlog4, sdlog = sdlog4)\n#kittide lõikes, kit1\nkit1=doping_subset[c(doping_subset$kit==1),]\nlog_norm_param5=fitdistr(x=kit1$ratio, densfun=\"log-normal\")\nmeanlog5=log_norm_param5$estimate[1]\nsdlog5=log_norm_param5$estimate[2]\nqlnorm(0.9999, meanlog = meanlog5, sdlog = sdlog5)\n#kit2\nkit2=doping_subset[c(doping_subset$kit==2),]\nlog_norm_param6=fitdistr(x=kit2$ratio, densfun=\"log-normal\")\nmeanlog6=log_norm_param6$estimate[1]\nsdlog6=log_norm_param6$estimate[2]\nqlnorm(0.9999, meanlog = meanlog6, sdlog = sdlog6)\n\n```\n\nAmetlik piirmäär kit1 korral oli 1.81 ja kit2 korral 1.68. Kas said sarnased tulemused? Kit1 korral enam-vähem, kit2 korral on erinevus suurem.\n\n\n##Kuidas verifitseeris otsustuspiire WADA?\n\nEsmased otsustuspiirid on määratud. Nüüd tuleb neid verifitseerida. Kuidas tegi seda WADA?\n\n- Rutiinsete dopingukontrollide käigus koguti aastatel 2009-2011 kit1 kohta 3547 mõõtmist ja kit2 kohta 617 mõõtmist.\n\n- Nendes andmetes puudub tunnus ethnicity.\n\n- Nüüd filtreeriti välja andmepunktid, kus rec kontsentratsioon oli väiksem kui 0.1 ja pit kontsentratsioon oli väiksem kui 0.05.\n\n- Lognormaaljaotus ei sobinud. Kasutati gammajaotust.\n\n- Visati välja 10 imelikku (liiga kõrget) andmepunkti.\n\n- Selle andmestiku põhjal arvutatud kvantiilid tulid väiksemad kui esmase uuringu kvantiilid. Järeldati, et esmased piirmäärad on verifitseeritud.\n\nLaadi ÕISist alla andmestik doping_verification.csv.\n\n```{r, cache=TRUE}\nverification=read.csv(\"./data/doping_verification.csv.\")\n\n```\n\n\n##Boonusülesanne (kuni 5 punkti)\n\nUuri ise midagi põnevat. Näiteks testi, kas tõesti enam log-normaaljaotus ei sobi, või uuri, milline mõju oli imelike andmepunktide väljaviskamisel.\n\n```{r, cache=TRUE, warning=FALSE, message=FALSE}\n#arvutame ratio\nverification$ratio=verification$rec/verification$pit\n#pean ka miinused ja nullid välja võtma, muidu ei tööta!!!!\nparam_verif1=fitdistr(x=(verification$ratio[!is.infinite(verification$ratio)&!is.na(verification$ratio)&verification$ratio>0]), densfun=\"log-normal\")\n\nmeanlog_verif1=param_verif1$estimate[1]\nsdlog_verif1=param_verif1$estimate[2]\n\n#viskame välja sodi\nverif_subset=subset(verification, rec>=0.01 & pit>=0.05)\nparam_verif2=fitdistr(x=verif_subset$ratio, densfun=\"log-normal\")\n\nmeanlog_verif2=param_verif2$estimate[1]\nsdlog_verif2=param_verif2$estimate[2]\n\nks.test(verif_subset$ratio,\"dlnorm\", meanlog=meanlog_verif2, sdlog=sdlog_verif2)\n\n#mis juhtus, kui viskasime välja osad vaatused\n    ggplot(verification, aes(ratio))+\n        geom_histogram(aes(y=..density..), binwidth=0.01, fill=\"blue\", colour=\"blue\", alpha=0.1 )+\n        geom_vline(xintercept=qlnorm(p=0.9999, meanlog = meanlog_verif1, sdlog = sdlog_verif1), colour=\"blue\")+    \n        geom_vline(xintercept=qlnorm(p=0.9999, meanlog = meanlog_verif2, sdlog = sdlog_verif2))+\n        stat_function(fun=dlnorm, args = list(meanlog=meanlog_verif1, sdlog=sdlog_verif1), colour=\"blue\")+\n        stat_function(fun=dlnorm, args = list(meanlog=meanlog_verif2, sdlog=sdlog_verif2))+\n        coord_cartesian(xlim=c(0, 3))+\n        geom_histogram(data=verif_subset,aes(y=..density..), binwidth=0.01, fill=\"grey\", colour=\"grey\", alpha=0.1)\n \n```\n\nSinine on see osa histogrammis, mida pärast väljaviskamist alles ei jäänud.\n\n\n##Testi kriitika\n\nSee, kas tegu on gamma- või lognormaaljaotusega on tegelikult mõnes mõttes pseudoprobleem. Tuleb silmas pidada, et me tahame hinnata väga äärmuslikku, 99,99% kvantiili. Kui me valimi põhjal mingi standardse testiga kontrollime parameetrilise jaotuse kehtivust ja jääme nullhüpoteesi juurde, siis see tähendab seda, et suurem osa andmete jaotusest, nn jaotuse “keha” sobib selle jaotuse mudeliga. See test ei ütle midagi jaotuse “saba” kaugema otsa kohta. Ei ole suurt mõtet valideerimisuuringutes näha vaeva sellega, kas algul eeldatud jaotus paika peab. Pigem tuleks näha vaeva sellega, et uurida otsusepiirist üle minevate tulemuste kohta mingitki tausta - kas on vähimatki lisatõendust dopingutarvitamise kohta? Ega ikka muudmoodi ei saagi seda valepositiivse tulemuse tõenäosust kätte. Ja kui see pole võimalik…siis kas saabki kehaomase aine lisadoseerimist täie kindlusega testida?\n\n##Ülesanne 7 (5 punkti) - bootstrap usaldusintervall otsustuspiirile\n\nTesti otsustuspiirid olid määratud vaid 106 sportlase põhjal, kui testiga hakati juba sportlaseid “vahele võtma”. Samas eeldati, et test teeb vaid 1 vea 10000 testis. Sellise täpsuse saamiseks oli valimimaht ilmselgelt liiga väike.\n\nArtiklis oli kirjas:\n\nWADA scientists claim that the test with the resulting DL (decision limit) has a specificity of at least 99.99%. The claimed false-positive rate of less than 1 in 10,000 is quite remarkable from a sample size of less than 200! Clearly, it relies strongly on the parametric form of testing results.\n\nLeia bootstrap 95% usaldusintervall dopingutesti piirmäärale (ehk 99.99% kvantiilile). Visualiseeri saadud tulemust.\n\n[Bootstrap](https://en.wikipedia.org/wiki/Bootstrapping_%28statistics%29) on üks viis leida valimihinnangule (näiteks meid huvitavale kvantiilile) usaldusintervall. Kui bootstrap on sinu jaoks uus, on abiks järgnev Coursera kursuse [Data Analysis and Statistical Inference](https://www.coursera.org/course/statistics) video Unit 4 Part 2 - Bootstrapping.\n    Juhul, kui sa ei soovi sellele kursusele registreeruda, saad seda videot vaadata ka [siit lingilt](https://www.dropbox.com/s/xez6gn4kyflpqkn/Data%20Analysis%20and%20Statistical%20Inference%20-%20Bootstrapping.mp4?dl=0)\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\npiir=numeric()\n\nfor (i in 1:10000) {\n    param=fitdistr(x=sample(verif_subset$ratio, replace=T), densfun=\"log-normal\")\n    meanlog=param$estimate[1]\n    sdlog=param$estimate[2]\n    piir[i]=qlnorm(0.9999, meanlog = meanlog, sdlog = sdlog) \n}\n\n#piirid 95% jagunemise järgi\nquantile(piir, c(.025, .5, .975))\n#teine variant\nse=sd(piir)/sqrt(length(piir))\nkeskmine=mean(piir)\nkeskmine+c(-1,1)*1.65*se\n\n```\n\nPlotime tulemused\n\n```{r, cache=TRUE, message=FALSE}\nhist(piir)\n#piirid 95% reaalsete andmete jagunemise jagunemise järgi\nabline(v=quantile(piir, c(.025, .5, .975))[1], col=\"blue\")\nabline(v=quantile(piir, c(.025, .5, .975))[3], col=\"blue\")\n\n#teine variant, kus 95% t-jaotuse järgi\nabline(v=keskmine+c(-1)*1.65*se, col=\"green\")\nabline(v=keskmine+c(1)*1.65*se, col=\"green\")\n\n\n```\n\nTeine variant on kitsam, kuna tegin mitu iteratsiooni (10 000) ja standard error on selle tõttu väike. Seega reaalne andmete jaotus (variant 1) võib anda täpsema tulemuse.\n\n##Ülesanne 8 (3 punkti) - valepositiivse testitulemuse tõenäosus\n\nCASis kohal käinud statistikud (1 Eestist, 1 vägagi nimekas professor USAst) tegid selgeks, et kui test on positiivne, siis dopingutarvitamise tõenäosus jääb vahemikku 10-90%. 90% on õige siis, kui WADA poolt väidetav spetsiifilisus 99,99% (ehk siis valepositiivse tõenäosus 0,01%) kehtib. 10% on õige siis, kui see on tegelikult 99,9%. WADA andmed ei võimalda kindlaks teha, kas ta tegelikult on 99,99% või 99,9%. Sellega oli nõus ka CAS\n\nKuidas leida dopingutarvitamise tõenäosust, kui sportlane sai positiivse testitulemuse?\n\nNäpunäited:\n\n- Oletame, et dopingutarvitajaid on 2%, testi tundlikkus on 25%, spetsiifilisus on 99.9% ning oleme testinud 10000 sportlast. Täida nende eelduste põhjal järgmine tabel:\n\nMeeldetuletus:\n\nTesti tundlikkus=õiged positiivsedõiged positiivsed + valenegatiivsed\n\nTesti spetsiifilisus=õiged negatiivsedõiged negatiivsed + valepositiivsed\n\nMis on tõenäosus, et positiivse dopingutesti korral on sportlane ka tegelikult dopingut tarvitanud?\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\ntabel=read.csv(\"./data/tundlikkus.csv\")\ntabel\n```\n\nTundlikkus on 25%, seega 25%, kes tarvitas näitab test tarvitajatena. Ehk siis 200*025=50 on tõeste positiivsete testide arv. Ülejäänud (200-50=150) on valenegatiivsed.\n\n```{r, cache=TRUE}\ntabel[1,2]=tabel[1,4]*0.25\ntabel[1,3]=tabel[1,4]-tabel[1,2]\ntabel\n```\n\nSpetsiifilisus on 99.9%, seega 99.9% kes, ei tarvitanud dopingut klassifitseerit õigesti õigeteks negatiivseteks.\n```{r, cache=TRUE}\ntabel[2,3]=tabel[2,4]*0.999\ntabel[2,2]=tabel[2,4]-tabel[2,3]\ntabel\n\n```\n\nTõenäosus, et positiivse testi korral oli sportlane ka dopingu vastu patustaja on õiged positiivsed/(õiged positiivsed+ valed positiivsed). Ehk:\n```{r, cache=TRUE}\ntabel[1,2]/(tabel[1,2]+tabel[2,2])\n```\n\n\n- Oletame nüüd, et testi spetsiifilisus on 99.99%. Mis on tõenäosus, et positiivse dopingutesti korral on sportlane ka tegelikult dopingut tarvitanud?\n\n```{r, cache=TRUE}\ntabel[2,3]=tabel[2,4]*0.9999\ntabel[2,2]=tabel[2,4]-tabel[2,3]\ntabel\ntabel[1,2]/(tabel[1,2]+tabel[2,2])\n\n```\n\n\n##Boonusülesanne (3 punkti)\n\nKasvuhormooni dopingutesti üks eeldustest oli, et isovormide suhe on konstantne.\n\n_Even though the levels of total hGH concentration will vary substantially, it is assumed the ratio between the relevant types of hGH isoforms measured by the test will naturally remain relatively stable._\n\nMõtle välja viis, kuidas kontrollida eeldust, et testi mõõdetud isovormide suhe on konstantne ning ei sõltu tegelikust kasvuhormooni kontsentratsioonist. Kontrolli eeldust kasutades enda väljapakutud lähenemist.\n\n```{r, cache=TRUE, message=FALSE, warning=FALSE}\nlibrary(ggplot2)\n#rec vs ratio\nggplot(verification, aes(x=rec, y=ratio))+\n    geom_point()\n\n#pit vs ratio\nggplot(verification, aes(x=pit, y=ratio))+\n    geom_point()\n\n#mõlemad liidame\nggplot(verification, aes(x=pit+rec, y=ratio))+\n    geom_point()\n\n#korrelatsioon\nverification_puhas=verification[!is.infinite(verification$ratio)&!is.na(verification$ratio),]\ncor(verification_puhas$pit, verification_puhas$ratio)\n\n#proovin sama algsete andmete pealt\nggplot(doping, aes(x=rec, y=ratio))+\n    geom_point()\n\n#pit vs ratio\nggplot(doping, aes(x=pit, y=ratio))+\n    geom_point()\n\n#mõlemad liidame\nggplot(doping, aes(x=pit+rec, y=ratio))+\n    geom_point()\n#korrelatsioon\ndoping_puhas=doping[!is.infinite(doping$ratio)&!is.na(doping$ratio),]\ncor(doping_puhas$pit, doping_puhas$ratio)\n\n```\n\nProovisin graafilist meetodit ja korrelatsiooni välja arvutada, mõlemad näitavad, et seost pole.",
    "created" : 1435399179748.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "584574532",
    "id" : "D49AC48F",
    "lastKnownWriteTime" : 1435400026,
    "path" : "~/Minu asjad/Statistika, mudelid, excel/R/Andmeteadus_TU/VIII praktikum/praktikum8_pdf.Rmd",
    "project_path" : "praktikum8_pdf.Rmd",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}