{
    "contents" : "#Laadi ÕISist alla andmestik doping.csv ja loe töökeskkonda. Andmestikus on \n#järgmised tunnused:\n#ethnicity - etnilisus: kas african või caucasian\n#kit - dopingutesti erinevad variandid (kit1 ja kit2)\n#rec - kasvuhormooni isovormi rec kontsentratsioon\n#pit - kasvuhormooni isovormi pit kontsentratsioon\n#Ülesanne 1 (1 punkt) - andmetega tutvumine\n#Lisa andmetabelisse tunnus ratio, mis näitab tunnuste rec ja pit suhet. \n#Visualiseeri tunnuste rec, pit ja ratio jaotusi.\n\ndoping=read.csv(\"./data/doping.csv\")\n#lisame ratio\ndoping$ratio=doping$rec/doping$pit\n#rec jaouts\nlibrary(ggplot2)\nggplot(doping, aes(x=rec))+\n    geom_density()\n#pit\nggplot(doping, aes(x=pit))+\n    geom_density()\n#ratio\nggplot(doping, aes(x=ratio))+\n    geom_histogram(aes(y= ..density..))+\n    stat_function(fun=dnorm)\n\nggplot(doping, aes(x=ratio))+\n    geom_density()+\n    stat_function(fun=dnorm)\n\n\n#log-normaalse jaoutse tihedus\nlibrary(ggplot2)\nlibrary(dplyr)\n\ni = 1\ndf_list = list()\nfor(m in c(0, 0.5, 1, 1.5)){\n    for(s in c(0.25, 0.5, 1, 2)){\n        # tiheduse graafiku jaoks x ja y koordinaadid\n        x = seq(0, 5, 0.01)\n        y = dlnorm(x, meanlog = m, sdlog = s)\n        \n        df_list[[i]] = data.frame(x=x, y=y, \n                                  group = paste(\"meanlog =\", m, \", sdlog =\", s))\n        i = i + 1\n    }\n}\ndf = rbind_all(df_list)\nggplot(df, aes(x, y)) + geom_area() + facet_wrap(~ group) + \n    coord_cartesian(ylim = c(0, 1))\n\n#Joonista ka gammajaotuse tihedusfunktsioonid Γ(α,β) erinevate α∈{1,2,3,4,5} j\n#a β∈{1,2,3,4,5} jaoks. Selgita, kuidas muutub jaotus, kui muudame kumbagi p\n#arameetrit.\n\ni = 1\ndf_list_gamma = list()\nfor(m in c(1, 2, 2, 4, 5)){\n    for(s in c(1, 2, 2, 4, 5)){\n        # tiheduse graafiku jaoks x ja y koordinaadid\n        x = seq(0, 5, 0.01)\n        y = dgamma(x, shape = m, rate = s)\n        \n        df_list_gamma[[i]] = data.frame(x=x, y=y, \n                                  group = paste(\"shape =\", m, \", rate =\", s))\n        i = i + 1\n    }\n}\ndf_gamma = rbind_all(df_list_gamma)\nggplot(df_gamma, aes(x, y)) + geom_area() + facet_wrap(~ group) + \n    coord_cartesian(ylim = c(0, 1))\n\n#Tihti eeldatakse statistikas, et tunnus on normaaljaotusega. Kas isovormide \n#suhe võiks põhimõtteliselt olla normaaljaotusega? Põhjenda\n#Ei, vaata joonist ratio jaotusest\n\n#Ülesanne 3 (2 punkti) - andmete filtreerimine\n#Mis sa arvad, miks jäeti analüüsist välja andmepunktid, kus rec või pit \n#kontsentratsioon oli väiksem kui 0.05?\n#Visualiseeri hajuvusdiagrammi abil, millised andmepunktid jäid analüüsist välja.\nvaljajaanud=subset(doping, rec<0.05| pit<0.05)\n\nggplot(valjajaanud, aes(x=rec))+\n    geom_density()\n\nggplot(valjajaanud, aes(x=pit))+\n    geom_density()\n\nggplot(valjajaanud, aes(x=ratio))+\n    geom_density()\n#andmed, mis jäid alles\ndoping_subset=subset(doping, rec>0.05& pit>0.05)\nggplot(doping_subset, aes(x=rec))+\n    geom_density()\n\nggplot(doping_subset, aes(x=pit))+\n    geom_density()\n\nggplot(doping_subset, aes(x=ratio))+\n    geom_density()\n\n#Log-normaaljaotusel on kaks parameetrit. Kuidas leiad sellised parameetrite \n#väärtused, mille korral jaotus sobiks andmetega kõige paremini? Leia need \n#parameetrid “kit1 - valged” osapopulatsiooni jaoks.\nlibrary(MASS)\nlog_norm_param=fitdistr(x=doping_subset[c(doping_subset$kit==1&doping_subset$ethnicity==\"caucasian\"), c(\"ratio\")], \n         densfun=\"log-normal\")\n\nmeanlog1=log_norm_param$estimate[1]\nsdlog1=log_norm_param$estimate[2]\n\n#gamma\ngamma_param=fitdistr(x=doping_subset[c(doping_subset$kit==1&doping_subset$ethnicity==\"caucasian\"), c(\"ratio\")], \n                        densfun=\"gamma\")\n\nshape1=gamma_param$estimate[1]\nrate1=gamma_param$estimate[2]\n\n#Leia kummagi jaotuse 99.99% kvantiil.\n#log-normal\nqlnorm(0.9999, meanlog = meanlog, sdlog = sdlog)\n#gamma\nqgamma(0.9999, shape=shape, rate = rate)\n\n#Visualiseeri ühel joonisel koos andmetega nii sobitatud log-normaal kui ka \n#gammajaotust. Lisa joonisele 99.99% kvantiil.\nkit1_caucasian=doping_subset[c(doping_subset$kit==1&doping_subset$ethnicity==\"caucasian\"),]\n\nggplot(kit1_caucasian, aes(x=ratio))+\n    geom_histogram(aes(y=..density..), binwidth=0.06, fill=\"white\", colour=\"black\" )+\n    stat_function(fun=dlnorm, args = list(meanlog=meanlog1, sdlog=sdlog1))+\n    stat_function(fun=dgamma, args=list(shape=shape1, rate=rate1), colour=\"blue\")+\n    geom_vline(xintercept=qlnorm(p=0.9999, meanlog = meanlog1, sdlog = sdlog1))+\n    geom_vline(xintercept=qgamma(p=0.9999, shape = shape1, rate = rate1), colour=\"blue\")+\n    coord_cartesian(xlim=c(0, 1.8))\n    \n#Kas eelnevalt sobitatud log-normaaljaotus võiks sobida andmetega? Mille alusel \n#otsustad?\n#Aga kas gammajaotus võiks sobida andmetega?\n#Praktikumis arutasime märksõnu QQplot ja Kolmogorov-Smirnovi test.\nqqnorm(kit1_caucasian$ratio)\nqqline(kit1_caucasian$ratio)\nks.test(kit1_caucasian$ratio,\"pgamma\", shape=shape1, rate=rate1)\nks.test(kit1_caucasian$ratio,\"dlnorm\", meanlog=meanlog1, sdlog=sdlog1)\n#log-normal pole, kolmogorov smirnovi test lükkb ümber, gamma aga on\n\n#Sobita nüüd kõigile neljale alamgrupile log-normaaljaotus ja leia selle 99.99% \n#kvantiil.\nkit2_caucasian=doping_subset[c(doping_subset$kit==2&doping_subset$ethnicity==\"caucasian\"),]\nkit1_african=doping_subset[c(doping_subset$kit==1&doping_subset$ethnicity==\"african\"),]\nkit2_african=doping_subset[c(doping_subset$kit==2&doping_subset$ethnicity==\"african\"),]\n#valged kit2\nlog_norm_param2=fitdistr(x=kit2_caucasian$ratio, densfun=\"log-normal\")\n\nmeanlog2=log_norm_param2$estimate[1]\nsdlog2=log_norm_param2$estimate[2]\n\nqlnorm(0.9999, meanlog = meanlog2, sdlog = sdlog2)\n#musatd kit1\nlog_norm_param3=fitdistr(x=kit1_african$ratio, densfun=\"log-normal\")\n\nmeanlog3=log_norm_param3$estimate[1]\nsdlog3=log_norm_param3$estimate[2]\n\nqlnorm(0.9999, meanlog = meanlog3, sdlog = sdlog3)\n#mustad kit2\nlog_norm_param4=fitdistr(x=kit2_african$ratio, densfun=\"log-normal\")\n\nmeanlog4=log_norm_param4$estimate[1]\nsdlog4=log_norm_param4$estimate[2]\n\nqlnorm(0.9999, meanlog = meanlog4, sdlog = sdlog4)\n#kittide lõikes, kit1\nkit1=doping_subset[c(doping_subset$kit==1),]\nlog_norm_param5=fitdistr(x=kit1$ratio, densfun=\"log-normal\")\n\nmeanlog5=log_norm_param5$estimate[1]\nsdlog5=log_norm_param5$estimate[2]\n\nqlnorm(0.9999, meanlog = meanlog5, sdlog = sdlog5)\n#kit2\nkit2=doping_subset[c(doping_subset$kit==2),]\nlog_norm_param6=fitdistr(x=kit2$ratio, densfun=\"log-normal\")\n\nmeanlog6=log_norm_param6$estimate[1]\nsdlog6=log_norm_param6$estimate[2]\n\nqlnorm(0.9999, meanlog = meanlog6, sdlog = sdlog6)\n\n#Ametlik piirmäär kit1 korral oli 1.81 ja kit2 korral 1.68. Kas said sarnased \n#tulemused?\n#Kit1 enam vähem sama (1.88), kit2 1.92\n\n\n\n#Esmased otsustuspiirid on määratud. Nüüd tuleb neid verifitseerida. Kuidas \n#tegi seda WADA?\n#Rutiinsete dopingukontrollide käigus koguti aastatel 2009-2011 kit1 kohta 3547 \n#mõõtmist ja kit2 kohta 617 mõõtmist.Nendes andmetes puudub tunnus ethnicity.\n#Nüüd filtreeriti välja andmepunktid, kus rec kontsentratsioon oli väiksem \n#kui 0.1 ja pit kontsentratsioon oli väiksem kui 0.05.Lognormaaljaotus ei \n#sobinud. Kasutati gammajaotust. Visati välja 10 imelikku (liiga kõrget) \n#andmepunkti.Selle andmestiku põhjal arvutatud kvantiilid tulid väiksemad kui \n#esmase uuringu kvantiilid. Järeldati, et esmased piirmäärad on verifitseeritud.\n#Laadi ÕISist alla andmestik doping_verification.csv.\n\nverification=read.csv(\"./data/doping_verification.csv.\")\n\n#Boonusülesanne (kuni 5 punkti)\n#Uuri ise midagi põnevat. Näiteks testi, kas tõesti enam log-normaaljaotus ei \n#sobi, või uuri, milline mõju oli imelike andmepunktide väljaviskamisel.\n#arvutame ratio\nverification$ratio=verification$rec/verification$pit\n#pean ka miinused ja nullid välja võtma, muidu ei tööta!!!!\nparam_verif1=fitdistr(x=(verification$ratio[!is.infinite(verification$ratio)&!is.na(verification$ratio)&verification$ratio>0]), densfun=\"log-normal\")\n\nmeanlog_verif1=param_verif1$estimate[1]\nsdlog_verif1=param_verif1$estimate[2]\n\n#viskame välja sodi\nverif_subset=subset(verification, rec>=0.01 & pit>=0.05)\nparam_verif2=fitdistr(x=verif_subset$ratio, densfun=\"log-normal\")\n\nmeanlog_verif2=param_verif2$estimate[1]\nsdlog_verif2=param_verif2$estimate[2]\n\nks.test(verif_subset$ratio,\"dlnorm\", meanlog=meanlog_verif2, sdlog=sdlog_verif2)\n\n#mis juhtus, kui viskasime välja osad vaatused\n    ggplot(verification, aes(ratio))+\n        geom_histogram(aes(y=..density..), binwidth=0.01, fill=\"blue\", colour=\"blue\", alpha=0.1 )+\n        #geom_density()+\n        geom_vline(xintercept=qlnorm(p=0.9999, meanlog = meanlog_verif1, sdlog = sdlog_verif1), colour=\"blue\")+    \n        geom_vline(xintercept=qlnorm(p=0.9999, meanlog = meanlog_verif2, sdlog = sdlog_verif2))+\n        stat_function(fun=dlnorm, args = list(meanlog=meanlog_verif1, sdlog=sdlog_verif1), colour=\"blue\")+\n        stat_function(fun=dlnorm, args = list(meanlog=meanlog_verif2, sdlog=sdlog_verif2))+\n        coord_cartesian(xlim=c(0, 3))+\n        geom_histogram(data=verif_subset,aes(y=..density..), binwidth=0.01, fill=\"grey\", colour=\"grey\", alpha=0.1)\n    \n#Leia bootstrap 95% usaldusintervall dopingutesti piirmäärale (ehk 99.99% \n#kvantiilile). Visualiseeri saadud tulemust.\npiir=numeric()\n\nfor (i in 1:10000) {\n    param=fitdistr(x=sample(verif_subset$ratio, replace=T), densfun=\"log-normal\")\n    meanlog=param$estimate[1]\n    sdlog=param$estimate[2]\n    piir[i]=qlnorm(0.9999, meanlog = meanlog, sdlog = sdlog) \n}\n\nhist(piir)\n#piirid 95% jagunemise järgi\nquantile(piir, c(.05, .5, .95))\n#teine variant\nse=sd(piir)/sqrt(length(piir))\nkeskmine=mean(piir)\nkeskmine+c(-1,1)*1.65*se\n\n#Boonusülesanne (3 punkti)\n#Kasvuhormooni dopingutesti üks eeldustest oli, et isovormide suhe on konstantne.\n#\nlibrary(ggplot2)\n#rec vs ratio\nggplot(verification, aes(x=rec, y=ratio))+\n    geom_point()\n\n#pit vs ratio\nggplot(verification, aes(x=pit, y=ratio))+\n    geom_point()\n\n#mõlemad liidame\nggplot(verification, aes(x=pit+rec, y=ratio))+\n    geom_point()\n\n#korrelatsioon\nverification_puhas=verification[!is.infinite(verification$ratio)&!is.na(verification$ratio),]\ncor(verification_puhas$pit, verification_puhas$ratio)\n\n#proovin sama algsete andmete pealt\nggplot(doping, aes(x=rec, y=ratio))+\n    geom_point()\n\n#pit vs ratio\nggplot(doping, aes(x=pit, y=ratio))+\n    geom_point()\n\n#mõlemad liidame\nggplot(doping, aes(x=pit+rec, y=ratio))+\n    geom_point()\n#korrelatsioon\ndoping_puhas=doping[!is.infinite(doping$ratio)&!is.na(doping$ratio),]\ncor(doping_puhas$pit, doping_puhas$ratio)\n\n\n",
    "created" : 1433956408949.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2863577103",
    "id" : "5806D40B",
    "lastKnownWriteTime" : 1434211240,
    "path" : "~/Minu asjad/Statistika, mudelid, excel/R/Andmeteadus_TU/VIII praktikum/praktikum8.R",
    "project_path" : "praktikum8.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}