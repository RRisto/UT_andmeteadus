{
    "contents" : "---\ntitle: \"KUidas tuvastada pettust?\"\nauthor: \"Risto Hinno\"\ndate: \"Tuesday, May 26, 2015\"\noutput: html_document\n---\n\n\n##Sissejuhatus\n\nMarkus “Märul” Veekahuri isa on politseinik, ema on politseinik, mõlemad vanaemad on politseinikud ja õde on politseinik. Algul vaadati viltuselt Markuse soovile ülikooli statistikat õppima minna, kuid pärast kahte kuud vaikimist vahetati telefoni teel esimene “tere” ning lepiti uuesti ära.\n\nKuid nagu elus ikka, ei kuku käbi kännust kaugele. Markus läks tööle Politsei- ja Piirivalveametisse ning tema igapäevatööks sai pettuste tuvastamine, kasutades statistilisi meetodeid. Tema ametirelvaks on Benfordi seadus.\n\nBenfordi seadus (sageli nimetatud kui esimese numbri seadus) kirjeldab arvu esimese numbri sagedust. Paljudes reaalsetes andmetes esineb number 1 esinumbrina umbes 30% juhtudest ning iga järgneva numbri sagedus kahaneb monotoonselt.\n\n##Maksude andmestik\n\nLoe sisse Maksu- ja Tolliameti maksude andmestik ja tutvu andmetega. Andmestikus on järgnevad tunnused:\n\n- registrikood: juriidilise isiku registrikood\n\n- nimi: juriidilise isiku nimi\n\n- liik: kas tegemist on äriühingu, MTÜ, FIE vms\n\n- kaibemaksukohustlane: kas juriidiline isik on käibemaksukohustlane\n\n- maakond: millises maakonnas on juriidiline isik registreeritud\n\n- riiklikud_maksud: käibemaks, tollimaks jne\n\n- toojoumaksud_ja_maksed: sotsiaalmaks, töötuskindlustusmakse jne\n\n##Ülesanne 1 (2 punkti)\n\nTee 3 joonist, mis iseloomustavad hästi seda andmestikku.\n\n```{r, cache=TRUE, warning=FALSE, message=FALSE}\nmaksud=read.csv2(\"./data/tolliamet_maksud.csv\")\nmaksud$riiklikud_maksud=as.numeric(as.character(maksud$riiklikud_maksud))\nmaksud$toojoumaksud_ja_maksed=as.numeric(as.character(\n    maksud$toojoumaksud_ja_maksed))\n\nlibrary(ggplot2)\n#maakonna keskmised\nlibrary(dplyr)\nlibrary(reshape2)\nmaksud_maakond_group=maksud %>%\n    group_by(maakond)%>%\nsummarise(kesk_riiklikud_maksud= mean(riiklikud_maksud, na.rm=T),\n          mediaan_riiklikud_maksud=median(riiklikud_maksud, na.rm=T),\n          kesk_tööjõumaksud= mean(toojoumaksud_ja_maksed, na.rm=T),\n          mediaan_tööjõumaksud=median(toojoumaksud_ja_maksed, na.rm=T))%>%\n    melt(id.vars=\"maakond\")\n\nggplot(maksud_maakond_group, aes(x=maakond, y=value))+\n    geom_point()+\n    facet_wrap(~variable)+\n    theme(axis.text.x  = element_text(angle=90, vjust=0.5))\n\n#jur vormi keskmised\nmaksud_liik_group=maksud %>%\n    group_by(liik)%>%\n    summarise(kesk_riiklikud_maksud= mean(riiklikud_maksud, na.rm=T),\n              mediaan_riiklikud_maksud=median(riiklikud_maksud, na.rm=T),\n              kesk_tööjõumaksud= mean(toojoumaksud_ja_maksed, na.rm=T),\n              mediaan_tööjõumaksud=median(toojoumaksud_ja_maksed, na.rm=T))%>%\n    melt(id.vars=\"liik\")\n\nggplot(maksud_liik_group, aes(x=liik, y=value/1000))+\n    geom_point()+\n    facet_wrap(~variable)+\n    theme_minimal()+\n    theme(axis.text.x  = element_text(angle=90, vjust=0.5))\nmaksud_sort=maksud%>%\n    mutate(summa=riiklikud_maksud+toojoumaksud_ja_maksed)%>%\n    arrange(-summa)\n#see on selleks, et ggplot kuvaks maksude järjekorras, mitte tähestikulises \n#järjekorras\nmaksud_sort$nimi <- as.character(maksud_sort$nimi)\n#Then turn it back into an ordered factor\nmaksud_sort$nimi <- factor(maksud_sort$nimi, levels=unique(maksud_sort$nimi))\n\nggplot(subset(maksud_sort, liik!=\"Valitsus- ja riigiasutus\")[1:20,], \n       aes(x=nimi, y=summa/100000))+\n    geom_bar(stat=\"identity\")+\n    scale_y_reverse()+\n    theme(axis.text.x  = element_text(angle=90, vjust=0.5))+\n    coord_flip()\n   \n    \n```\n\n##Ülesanne 2 (2 punkti)\n\nKontrolli visuaalselt Benfordi seaduse kehtimist tunnustel riiklikud maksud ja toojoumaksud ja maksed. Selleks tekita esinumbrite histogramm. Nulliga võrduvad väärtused jäta kõrvale. Tee vastav joonis ka FIE-de, äriühingute jne lõikes (vt tunnus liik).\n\nNäpunäide: esimest numbrit aitab eralda näiteks funktsioon substr.\n\n```{r, warning=FALSE, message=FALSE, cache=TRUE}\n#lõikame esimese numbri maha\nmaksud_sort$esimene_nr_riikl=substr(maksud_sort$riiklikud_maksud, 1, 1)\nmaksud_sort$esimene_nr_tooj=substr(maksud_sort$toojoumaksud_ja_maksed, 1, 1)\n\n#riiklike maksude osas\nlibrary(ggplot2)\nkokku_count=nrow(subset(maksud_sort,esimene_nr_riikl!=0))\nmaksud_sort2=subset(maksud_sort,esimene_nr_riikl!=0)\nlibrary(dplyr)\nmaksud_sort2=maksud_sort2 %>%\n    group_by(esimene_nr_riikl) %>%\n    summarise(osakaal=n()/kokku_count)\n\nlibrary(BenfordTests)\n#Benfordi seadusele vastav jaotus\nbenford=as.data.frame(pbenf(digits = 1))\n\nggplot(maksud_sort2, aes(x=factor(esimene_nr_riikl), y=osakaal, group=1))+\n    geom_point(colour=\"red\")+\n    geom_line()+\n    geom_line(data=benford, aes(x=Var1, y=Freq,group=1), colour=\"red\")\n#lõikame esimese numbri maha\nmaksud_sort$esimene_nr_riikl=substr(maksud_sort$riiklikud_maksud, 1, 1)\nmaksud_sort$esimene_nr_tooj=substr(maksud_sort$toojoumaksud_ja_maksed, 1, 1)\n\n#riiklike maksude osas\nlibrary(ggplot2)\nkokku_count=nrow(subset(maksud_sort,esimene_nr_riikl!=0))\nmaksud_sort2=subset(maksud_sort,esimene_nr_riikl!=0)\nlibrary(dplyr)\nmaksud_sort2=maksud_sort2 %>%\n    group_by(esimene_nr_riikl) %>%\n    summarise(osakaal=n()/kokku_count)\n\nlibrary(BenfordTests)\n#Benfordi seadusele vastav jaotus\nbenford=as.data.frame(pbenf(digits = 1))\n\nggplot(maksud_sort2, aes(x=factor(esimene_nr_riikl), y=osakaal, group=1))+\n    geom_point(colour=\"red\")+\n    geom_line()+\n    geom_line(data=benford, aes(x=Var1, y=Freq,group=1), colour=\"red\")\n#liikide lõikes tööjõumaksud\nkokku_count_too=nrow(subset(maksud_sort,esimene_nr_tooj!=0))\nmaksud_sort4=subset(maksud_sort,esimene_nr_tooj!=0)\n#arvutame iga liigi counti ja siis iga liigi iga algusnumbri count ja \n#osakaalu\nlibrary(dplyr)\nmaksud_sort4=maksud_sort4 %>%\n    group_by(liik) %>%\n    mutate(count=n())%>%\n    group_by(liik,esimene_nr_tooj) %>%\n    mutate(count_grupp=n(), \n           osakaal_grupp=count_grupp/count)\n\nlibrary(BenfordTests)\n#Benfordi seadusele vastav jaotus\nbenford=as.data.frame(pbenf(digits = 1))\n\nggplot(subset(maksud_sort4, liik!=\"Eestis asuv rahvusvaheline organisatsioon\"), \n       aes(x=factor(esimene_nr_tooj), y=osakaal_grupp, group=1))+\n    geom_point(colour=\"red\")+\n    geom_line()+\n    xlab(\"Algusnumber\")+\n    ylab(\"Esinemissagedus\")+\n    geom_line(data=benford, aes(x=Var1, y=Freq,group=1), colour=\"red\")+\n    facet_wrap(~liik)\n\n##liikide riiklikud maksud\nkokku_count_riikl=nrow(subset(maksud_sort,esimene_nr_riikl!=0))\nmaksud_sort5=subset(maksud_sort,esimene_nr_riikl!=0)\n#arvutame iga liigi counti ja siis iga liigi iga algusnumbri count ja \n#osakaalu\nlibrary(dplyr)\nmaksud_sort5=maksud_sort5 %>%\n    group_by(liik) %>%\n    mutate(count=n())%>%\n    group_by(liik,esimene_nr_riikl) %>%\n    mutate(count_grupp=n(), \n           osakaal_grupp=count_grupp/count)\n\nggplot(subset(maksud_sort5, liik!=\"Eestis asuv rahvusvaheline organisatsioon\"), \n              aes(x=factor(esimene_nr_riikl), y=osakaal_grupp, group=1))+\n    geom_point(colour=\"red\")+\n    geom_line()+\n    geom_line(data=benford, aes(x=Var1, y=Freq,group=1), colour=\"red\")+\n    facet_wrap(~liik)\n\n```\n\nKommenteeri tulemusi.\n\nKas sellest võib järeldada, et FIE-d jahmerdavad maksudega?",
    "created" : 1465555995040.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1836444133",
    "id" : "5B5FD8AA",
    "lastKnownWriteTime" : 1465557260,
    "path" : "~/Asjad vanast arvutist/Statistika, mudelid, excel/R/Andmeteadus_TU/II praktikum/praktikum2_pettus.Rmd",
    "project_path" : "praktikum2_pettus.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_markdown"
}